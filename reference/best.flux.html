<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Automatic selection of best flux estimate — best.flux • goFlux</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Automatic selection of best flux estimate — best.flux"><meta property="og:description" content="This automatic selection of the best flux estimate (linear,
LM.flux; or non-linear, Hutchinson and Mosier
model, HM.flux) is based on objective criteria."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">goFlux</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Automatic selection of best flux estimate</h1>

    <div class="hidden name"><code>best.flux.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This automatic selection of the best flux estimate (linear,
<code><a href="LM.flux.html">LM.flux</a></code>; or non-linear, Hutchinson and Mosier
model, <code><a href="HM.flux.html">HM.flux</a></code>) is based on objective criteria.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">best.flux</span><span class="op">(</span></span>
<span>  <span class="va">flux.result</span>,</span>
<span>  criteria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAE"</span>, <span class="st">"RMSE"</span>, <span class="st">"AICc"</span>, <span class="st">"SE"</span>, <span class="st">"g.factor"</span>, <span class="st">"kappa"</span>, <span class="st">"MDF"</span>, <span class="st">"nb.obs"</span>,</span>
<span>    <span class="st">"intercept"</span>, <span class="st">"p-value"</span><span class="op">)</span>,</span>
<span>  intercept.lim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  g.limit <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  p.val <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  k.ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  warn.length <span class="op">=</span> <span class="fl">60</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-flux-result">flux.result<a class="anchor" aria-label="anchor" href="#arg-flux-result"></a></dt>
<dd><p>data.frame; output from the function
<code><a href="goFlux.html">goFlux</a></code>.</p></dd>


<dt id="arg-criteria">criteria<a class="anchor" aria-label="anchor" href="#arg-criteria"></a></dt>
<dd><p>character vector; criteria used to assess the goodness of fit
of the LM or HM flux estimates. Must be at least one the
following: "MAE", "RMSE", "AICc", "SE", "g.factor", "kappa",
"MDF", "nb.obs", "p-value", or "intercept". The default is
all of them.</p></dd>


<dt id="arg-intercept-lim">intercept.lim<a class="anchor" aria-label="anchor" href="#arg-intercept-lim"></a></dt>
<dd><p>numerical vector of length 2; inferior and superior
limits of the intercept (initial concentration;
C<sub>0</sub>).
Must be the same units as <code>gastype</code> in the
<code><a href="goFlux.html">goFlux</a></code> function. If
<code>intercept.lim = NULL</code>, the limits are calculated
from the true values of
C<sub>0</sub> and
C<sub>t</sub>
for each measurement.</p></dd>


<dt id="arg-g-limit">g.limit<a class="anchor" aria-label="anchor" href="#arg-g-limit"></a></dt>
<dd><p>numerical value; maximum limit of the g-factor (ratio
between <code><a href="HM.flux.html">HM.flux</a></code> and
<code><a href="LM.flux.html">LM.flux</a></code>). Recommended
thresholds for the g-factor are 4 (flexible), 2 (medium), or
1.25 (conservative). The default limit is <code>g.limit = 2</code>.</p></dd>


<dt id="arg-p-val">p.val<a class="anchor" aria-label="anchor" href="#arg-p-val"></a></dt>
<dd><p>numerical value; the minimal limit to indicate a slope
significantly larger than zero. The default threshold is
<em>p-value</em> &lt; 0.05.</p></dd>


<dt id="arg-k-ratio">k.ratio<a class="anchor" aria-label="anchor" href="#arg-k-ratio"></a></dt>
<dd><p>numerical value; maximum limit of the ratio between kappa and
the kappa-max. Default is <code>k.ratio = 1</code>.</p></dd>


<dt id="arg-warn-length">warn.length<a class="anchor" aria-label="anchor" href="#arg-warn-length"></a></dt>
<dd><p>numerical value; limit under which a measurement is flagged for
being too short (<code>nb.obs &lt; warn.length</code>).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A data.frame identical to the input <code>flux.result</code> (output from
         goFlux) with the additional columns <code>HM.diagnose</code>,
         <code>LM.diagnose</code>, <code>best.flux</code>, <code>model</code> and
         <code>quality.check</code>. For each criteria selected, an additional
         column is also added to specify the limits used for those criteria
         (e.g. <code>RMSE.lim</code>, <code>p.val.lim</code>, etc.)</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>In <code>criteria</code>, the indices of model fit "MAE", "RMSE" and "SE" all
have a threshold. For MAE and RMSE, the threshold is instrument precision
(1\(\sigma\)). For SE, the threshold is the instrument accuracy
(1\(\sigma\)/\(\sqrt{n}\)). These indices also compare the two models
(linear, LM, and non-linear, HM). The selection of the best model based on
indices of model fit ("MAE", "RMSE", "AICc" and "SE") is based on a scoring
system. Both models start with a score of 0. For each criteria, whichever
model performs worst is given +1. After all selected criteria have been
evaluated, the model with the lowest score wins. In case of a tie, the
HM flux estimate is always chosen by default, as non-linearity is assumed.
The score is printed in the columns HM.score and LM.score.</p>
<p>The <code>g.limit</code> indicates a threshold for the
<code><a href="g.factor.html">g.factor</a></code>, which is the ratio between a
non-linear flux estimate and a linear flux estimate. With the
<code>best.flux</code> function, one can choose a limit at
which the HM model is deemed to overestimate
f<sub>0</sub>. Recommended thresholds
for the g-factor are &lt;4 for a flexible threshold, &lt;2 for a medium threshold,
or &lt;1.25 for a more conservative threshold. The default threshold is
<code>g.limit = 2</code>. If the g-factor is above the specified threshold, the
best flux estimate will switch to LM instead of HM and give a warning in the
columns <code>quality.check</code> and <code>HM.diagnose</code>.</p>
<p>The minimal detectable flux (<code><a href="MDF.html">MDF</a></code>) is calculated from
the instrument precision, the measurement time and the flux.term. Flux
estimates below the MDF are considered under the detection limit, but not
null. Therefore, the function will not return a 0. There will simply be a
warning in the columns <code>quality.check</code>, <code>LM.diagnose</code> or
<code>HM.diagnose</code> to warn of a flux estimate under the detection limit. No
best flux estimate is chosen based on MDF.</p>
<p>The parameter kappa determines the curvature of the non-linear regression in
the Hutchinson and Mosier model. A maximum value of kappa,
<code><a href="k.max.html">k.max</a></code> is included in the
<code><a href="goFlux.html">goFlux</a></code> function, so that the HM regression
cannot exceed this maximum curvature. In the function
<code>best.flux</code>, one can choose the linear flux
estimate over the HM flux estimate based on the ratio between kappa
and kappa-max (<code>k.ratio</code>). The ratio is expressed as a percentage, where
1 indicates <code>HM.k = k.max</code>, and 0.5 indicates <code>HM.k = 0.5*k.max</code>.
The default setting is <code>k.ratio = 1</code>. If <code>HM.k/k.max</code> is larger
than <code>k.ratio</code>, a warning is issued in the columns <code>HM.diagnose</code>
and <code>quality.check</code>.</p>
<p>If the initial gas concentration
(C<sub>0</sub>) calculated for the
flux estimates (<code>HM.C0</code> and <code>LM.C0</code>) deviates from the true
(C<sub>0</sub>) by more or less than
10% of the difference between
C<sub>0</sub> and the final gas
concentration at the end of the measurement
(C<sub>t</sub>), a warning is issued
in the columns <code>quality.check</code>, <code>LM.diagnose</code> or <code>HM.diagnose</code>
to warn of an intercept out of bounds. Alternatively, one can provide
boundaries for the intercept, for example: <code>intercept.lim = c(380, 420)</code>
for a true C<sub>0</sub> of 400 ppm.</p>
<p>The argument <code>p.val</code> is only applicable to the linear flux. Under the
defined <em>p-value</em>, the slope of the linear flux estimate is deemed
non-significant, i. e., flux under the detection limit. The default threshold is
<code>p.val = 0.05</code>. No best flux estimate is chosen based on <em>p-value</em>.
If <code>LM.p.val &lt; p.val</code>, a warning is given in the columns
<code>quality.check</code> and <code>LM.diagnose</code> to warn of an estimated flux
below the detection limit.</p>
<p><code>warn.length</code> is the limit below which the chamber closure time is
flagged for being too short (<code>nb.obs &lt; warn.length</code>). Portable
greenhouse gas analyzers typically measure at a frequency of 1 Hz. Therefore,
for the default setting of <code>warn.length = 60</code>, the chamber closure time
should be approximately one minute (60 seconds). If the number of
observations  is smaller than the threshold, a warning is issued in the
column <code>quality.check</code>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Hüppi et al. (2018). Restricting the nonlinearity parameter in
soil greenhouse gas flux calculation for more reliable flux estimates.
<em>PloS one</em>, 13(7), e0200876.</p>
<p>Hutchinson and Mosier (1981). Improved soil cover method for
field measurement of nitrous oxide fluxes.
<em>Soil Science Society of America Journal</em>, 45(2), 311-316.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Look up the functions <code><a href="MDF.html">MDF</a></code>,
         <code><a href="flux.term.html">flux.term</a></code>,
         <code><a href="g.factor.html">g.factor</a></code>,
         <code><a href="k.max.html">k.max</a></code>,
         <code><a href="HM.flux.html">HM.flux</a></code> and
         <code><a href="LM.flux.html">LM.flux</a></code>
         of this package for more information about these parameters.</p>
<p>See also the function <code><a href="goFlux.html">goFlux</a></code>
         for more information about usage.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">manID.UGGA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">CO2_flux</span> <span class="op">&lt;-</span> <span class="fu"><a href="goFlux.html">goFlux</a></span><span class="op">(</span><span class="va">manID.UGGA</span>, <span class="st">"CO2dry_ppm"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"><span><span class="va">CO2_best</span> <span class="op">&lt;-</span> <span class="fu">best.flux</span><span class="op">(</span><span class="va">CO2_flux</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Karelle Rheault, Klaus Steenberg Larsen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

